---
description: Zustand 상태 관리 패턴 및 베스트 프랙티스
globs: store/**/*.ts
alwaysApply: false
---

# Zustand 상태 관리 패턴

## 스토어 생성

스토어는 `store/useFeatureStore.ts` 형식으로 생성합니다.

```tsx
// ✅ GOOD
import { create } from 'zustand';

interface StoreState {
  data: DataType[];
  isLoading: boolean;
  setData: (data: DataType[]) => void;
  setLoading: (loading: boolean) => void;
}

const useFeatureStore = create<StoreState>()((set) => ({
  data: [],
  isLoading: false,
  setData: (data) => set({ data }),
  setLoading: (loading) => set({ isLoading: loading }),
}));

export default useFeatureStore;
```

## localStorage 연동

인증 정보 등 영구 저장이 필요한 경우 localStorage와 연동합니다.

```tsx
// ✅ GOOD
const getStoredData = (): DataType | null => {
  if (typeof window === 'undefined') return null;
  try {
    const stored = localStorage.getItem('key');
    return stored ? JSON.parse(stored) : null;
  } catch (error) {
    console.error('Failed to parse stored data:', error);
    return null;
  }
};

const setStoredData = (data: DataType) => {
  if (typeof window === 'undefined') return;
  try {
    localStorage.setItem('key', JSON.stringify(data));
  } catch (error) {
    console.error('Failed to store data:', error);
  }
};

const useAuthStore = create<AuthState>()((set) => ({
  userInfo: getStoredData() || { email: '', token: '' },
  setInfo: (data) => {
    set({ userInfo: data });
    setStoredData(data);
  },
  clearInfo: () => {
    set({ userInfo: { email: '', token: '' } });
    localStorage.removeItem('key');
  },
}));
```

## Cookie 연동

토큰 등은 Cookie와 함께 관리합니다.

```tsx
// ✅ GOOD
import Cookies from 'js-cookie';

setInfo: (data) => {
  set({ userInfo: data });
  setStoredData(data);
  Cookies.set('token', data.token, {
    expires: 1,
    secure: process.env.NEXT_PUBLIC_TYPE !== 'dev',
    sameSite: 'Strict'
  });
},
```

## 컴포넌트에서 사용

```tsx
// ✅ GOOD
'use client';

import useAuthStore from '@/store/useAuthStore';

export default function MyComponent() {
  const { userInfo, setInfo, clearInfo } = useAuthStore();
  
  // 특정 값만 선택
  const userName = useAuthStore((state) => state.userInfo.userName);
  
  return <div>{userName}</div>;
}
```

## 초기화 패턴

컴포넌트 마운트 시 localStorage에서 복원합니다.

```tsx
// ✅ GOOD
useEffect(() => {
  initializeFromStorage();
}, [initializeFromStorage]);
```

## 타입 안정성

모든 상태와 액션에 타입을 명시합니다.

```tsx
// ✅ GOOD
interface User {
  userId?: string;
  userName?: string;
  email: string;
  token: string;
}

interface AuthState {
  userInfo: User;
  setInfo: (data: User) => void;
  clearInfo: () => void;
}
```
